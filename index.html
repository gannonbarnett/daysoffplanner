<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Days Off</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="common.css">
    <link rel="icon" href="icon.png">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.1.1"></script>
    <script src="index.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js'
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.6.0/firebase-analytics.js'
        import {
            getAuth,
            onAuthStateChanged,
            signOut,
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword
        } from 'https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js'
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js'
        import 'https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js'

        const firebaseConfig = {
            apiKey: "AIzaSyAOxa1tqQgoTPgswVW-7mTQBEfiYVrL2mI",
            authDomain: "daysoffplanner.firebaseapp.com",
            projectId: "daysoffplanner",
            storageBucket: "daysoffplanner.appspot.com",
            messagingSenderId: "999511004889",
            appId: "1:999511004889:web:eb57c65f29eeffb97bd0c8",
            measurementId: "G-6CX91Q6S19"
        };

        // Initialize Firebase
        export const app = initializeApp(firebaseConfig);
        export const analytics = getAnalytics(app);
        export const auth = getAuth(app);

        // Test acct: gannonbarnett@gmail.com, stupidpass1

        onAuthStateChanged(auth, (user) => {

            document.getElementById("signInOrCreate").onclick = signInOrCreate;
            document.getElementById("sign-out-button").onclick = trySignOut;
            document.getElementById("unsubscribe-button").onclick = unsubscribe;

            if (user) {
                console.log("Signed in");
                // User is signed in, see docs for a list of available properties
                // https://firebase.google.com/docs/reference/js/auth.user
                const uid = user.uid;
                console.log(uid);
                [...document.getElementsByClassName("hide-logged-in")].forEach(el => {
                    el.style.display = "none";
                });
                [...document.getElementsByClassName("hide-logged-out")].forEach(el => {
                    el.style.display = "inherit";
                });
                document.getElementById("container").style.marginLeft = "0%";   
                document.getElementById("container").style.width = "100%";   

                document.getElementById("password").value = "";
            } else {
                [...document.getElementsByClassName("hide-logged-in")].forEach(el => {
                    el.style.display = "inherit";
                });
                [...document.getElementsByClassName("hide-logged-out")].forEach(el => {
                    el.style.display = "none";
                });
                document.getElementById("container").style.marginLeft = "25%";   
                document.getElementById("container").style.width = "75%";   
            }
        });

        function signInOrCreate() {
            console.log("signInOrCreate");
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            console.log("signIn");
            signInWithEmailAndPassword(auth, email, password).then((userCredential) => {
                // Signed in 
                const user = userCredential.user;
                console.log(user);
                // ...
            }).catch((error) => {
                const errorCode = error.code;
                console.log(error.code);
                console.log("create");
                createUserWithEmailAndPassword(auth, email, password).then((userCredential) => {
                    console.log("created success");
                    // Signed up 
                    const user = userCredential.user;
                }).catch((error) => {
                    console.log("create failed");
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    console.log(errorMessage);
                });
            });
        }

        function trySignOut() {
            signOut(auth).then(() => {
            // Sign-out successful.
            }).catch((error) => {
            // An error happened.
            });
        }

        function unsubscribe() {
            console.log("unsubscribe unimplemented");
        }
    </script>
    <script src="firebase-stuff.js">  </script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" />
</head>

<body>
    <div class="subscribe-horizontal hide-logged-in" id="subscribe-horizontal">
        <div class="subscribe-body">
            <div class="login-container">
                <h3>Save your plans for $10 a year</h3>
                <p>Or, welcome back! Sign in to continue where you left off.</p>
                <div class="form-group">
                    <input type="email" id="email" name="email" required placeholder="email">
                </div>
                <div class="form-group">
                    <input type="password" id="password" name="password" required placeholder="password">
                </div>
                <div class="form-group" style="margin-bottom: 0px;">
                    <button id="signInOrCreate">Gametime</button>
                </div>
            </div>
        </div>
    </div>
    <div id="container" class="container main-horizontal" style="margin-left:25%; width:75%;">
        <div class="header-div">
            <ul class="header-ul">
                <li class="header-li title">Days Off Planner</li>
                <li class="header-li" style="float:right">
                    <div class="sign-out hide-logged-out" style="cursor:pointer;">
                        <div id="sign-out-button">Sign out</div>
                    </div>
                </li>
                <li class="header-li" style="float:right">
                    <div class="unsubscribe hide-logged-out" style="cursor:pointer;">
                        <div id="unsubscribe-button">Unsubscribe</div>
                    </div>
                </li>
                <li class="header-li" style="float:right">
                    <div class="holidays-div">
                        <div onclick="toggleHolidayList()">Holidays</div>
                        <div id="holidays-content-div-id" class="holidays-content-div"> </div>
                    </div>
                </li>
                <li class="header-li" style="float:right">
                    <div id="input-div">
                        Current Balance (Days): <input id="pinned-balance-value" type="number" step="any" value="0.0"
                            onchange="currentBalanceChanged()" />
                    </div>
                </li>
                <li class="header-li" style="float:right">
                    <div id="input-div">
                        Days Off Per Year: <input id="timeoff-rate" type="number" step="any" value="15"
                            onchange="reloadGraph()" />
                    </div>
                </li>
            </ul>
        </div>

        <div class="non-header-div">
            <div id="annual-div-id" class="annual-div" onload="loadFromCookies()">
            </div>
            <div class="chart-div"><canvas id="chart"></canvas></div>
        </div>
    </div>
</body>

</html>